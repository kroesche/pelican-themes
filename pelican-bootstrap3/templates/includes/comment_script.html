{% if PELICAN_COMMENT_SYSTEM %}

<script type="text/javascript">
    function reply(id)
    {
        id = decodeURIComponent(id);
        $('#commentForm_replyto').val(id);
    }

    $(document).ready(function() {
        function generateMailToLink()
        {
            var user = '{{ COMMENT_EMAIL_USER }}';
            var domain = '{{ COMMENT_EMAIL_DOMAIN }}';
            var subject = '{{ COMMENT_EMAIL_SUBJECT }}';

            var d = new Date();
            var body = ''
                + 'New comment for ' + document.URL + '\n\nGreetings ' + $("#commentForm_inputName").val() + '\n\n\n'
                + 'Raw comment data:\n'
                + '----------------------------------------\n'
                + 'date: ' + d.getFullYear() + '-' + (d.getMonth()+1) + '-' + d.getDate() + ' ' + d.getHours() + ':' + d.getMinutes() + '\n'
                + 'author: ' + $("#commentForm_inputName").val() + '\n';

            var replyto = $('#commentForm_replyto').val();
            if (replyto.length != 0)
            {
                body += 'replyto: ' + replyto + '\n'
            }

            body += '\n'
                + $("#commentForm_inputText").val() + '\n'
                + '----------------------------------------\n';

            var link = 'mailto:' + user + '@' + domain + '?subject='
                + encodeURIComponent(subject)
                + "&body="
                + encodeURIComponent(body);
            return link;
        }


        $('#commentForm').on("submit",
            function( event )
            {
                event.preventDefault();
                $(location).attr('href', generateMailToLink());
            }
        );
    });
</script>

{% endif %}

